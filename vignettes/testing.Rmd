---
title: "test"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(data.table)
library(sl3)
n <- 250
V <- runif(n, min = -1, max = 1)
W <- runif(n, min = -1, max = 1)
A <- rbinom(n, size = 1, prob = 0.66*plogis(W))
A[A==1] <- 2
A[A==0] <- rbinom(n, size = 1, prob = plogis(W))
table(A)
Y <- rnorm(n, mean = A * (1 + W  ) + W , sd = 0.5)
data <- data.table(W,A,Y)
node_list <- list(W = "W", A = "A", Y = "Y")
learner_list <- list(
  A = Lrnr_pooled_hazards$new(Lrnr_earth$new()),
  Y = Lrnr_earth$new()
)
spec <- tmle3_Spec_npCausalGLM$new(~1+W, treatment_level = 1, estimand = "CATT")
out <- tmle3(spec, data, node_list, learner_list)

spec <- tmle3_Spec_npCausalGLM$new(~1+W, treatment_level = 2, estimand = "CATT")
out1 <- tmle3(spec, data, node_list, learner_list)
out
out1

spec <- tmle3_Spec_npCausalGLM$new(~1+W, treatment_level = 1, estimand = "CATE")
out <- tmle3(spec, data, node_list, learner_list)

spec <- tmle3_Spec_npCausalGLM$new(~1+W, treatment_level = 2, estimand = "CATE")
out1 <- tmle3(spec, data, node_list, learner_list)
out
out1
```

```{r}
library(data.table)
library(sl3)
n <- 250
V <- runif(n, min = -1, max = 1)
W <- runif(n, min = -1, max = 1)
A <- rbinom(n, size = 1, prob = 0.66*plogis(W))
A[A==1] <- 2
A[A==0] <- rbinom(n, size = 1, prob = plogis(W))
table(A)
Y <- rpois(n, lambda = exp( A * (1 + W)  + sin(5 * W)))
data <- data.table(W,A,Y)
node_list <- list(W = "W", A = "A", Y = "Y")
learner_list <- list(
  A = Lrnr_pooled_hazards$new(Lrnr_earth$new()),
  Y = Lrnr_glmnet$new(formula = ~.^2, family = poisson())
)
spec <- tmle3_Spec_npCausalGLM$new(~1+W, estimand = "RR", treatment_level = 1 )
out <- tmle3(spec, data, node_list, learner_list)

spec <- tmle3_Spec_npCausalGLM$new(~1+W, estimand = "RR", treatment_level = 2 )
out1 <- tmle3(spec, data, node_list, learner_list)
out
out1
```


